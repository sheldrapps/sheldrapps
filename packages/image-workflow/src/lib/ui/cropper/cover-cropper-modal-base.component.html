<ion-header>
  <ion-toolbar>
    <ion-title>{{ uiLabels.title }}</ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="cancel()">
        {{ uiLabels.cancelLabel }}
      </ion-button>

      <ion-button [disabled]="!ready" (click)="use()">
        {{ uiLabels.doneLabel }}
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="cropper-content" [fullscreen]="true" [scrollY]="false">
  <div class="stage">
    <div class="frame-wrap">
      <div
        #frame
        class="frame"
        [style.--crop-ratio]="aspectRatio"
        (dblclick)="reset()"
        [attr.aria-label]="uiLabels.frameAriaLabel"
      >
        @if (imageUrl) {
        <img
          #img
          class="img"
          [src]="imageUrl"
          alt=""
          draggable="false"
          (load)="onImgLoad($event)"
        />
        }

        @if (showGrid) {
        <div class="grid" aria-hidden="true"></div>
        }

        @if (!ready) {
        <div class="frame-loader" aria-hidden="true">
          <div class="frame-loader__card">
            <ion-spinner name="crescent"></ion-spinner>
            <div class="frame-loader__text">
              {{ uiLabels.loadingLabel }}
            </div>
          </div>
        </div>
        }
      </div>
    </div>

    @if (ready && showHint) {
    <div class="hint">
      {{ uiLabels.hintLabel }}
    </div>
    }
  </div>

  <div
    class="bottom-bar"
    role="toolbar"
    [attr.aria-label]="uiLabels.controlsAriaLabel"
  >
    <ion-button
      fill="clear"
      class="ctrl"
      (click)="zoomOut()"
      [disabled]="scale <= minScale"
      [attr.aria-label]="uiLabels.zoomOutAriaLabel"
    >
      <ion-icon name="remove-outline"></ion-icon>
    </ion-button>

    <ion-button
      fill="clear"
      class="ctrl"
      (click)="reset()"
      [attr.aria-label]="uiLabels.resetAriaLabel"
    >
      <ion-icon name="refresh-outline"></ion-icon>
    </ion-button>

    <ion-button
      fill="clear"
      class="ctrl"
      (click)="zoomIn()"
      [disabled]="scale >= maxScale"
      [attr.aria-label]="uiLabels.zoomInAriaLabel"
    >
      <ion-icon name="add-outline"></ion-icon>
    </ion-button>

    <div class="spacer"></div>

    @if (showAdjustments) {
    <ion-button
      class="adjust-btn"
      (click)="toggleAdjustments()"
      [disabled]="!ready"
    >
      {{ uiLabels.adjustmentsLabel }}
      <ion-icon
        class="adjust-btn__icon"
        [name]="adjustOpen ? 'close-outline' : 'chevron-up-outline'"
      ></ion-icon>
    </ion-button>
    }
  </div>

  @if (adjustOpen && showAdjustments) {
  <div
    class="sheet"
    role="dialog"
    [attr.aria-label]="uiLabels.adjustmentsAriaLabel"
  >
    <div class="sheet-head">
      <ion-button
        fill="clear"
        class="sheet-reset"
        (click)="resetAdjustments()"
        [attr.aria-label]="uiLabels.resetAdjustmentsAriaLabel"
      >
        <ion-icon slot="icon-only" name="refresh-outline"></ion-icon>
      </ion-button>

      <div class="sheet-grabber" aria-hidden="true"></div>

      <div class="sheet-title">
        {{ uiLabels.adjustmentsLabel }}
      </div>

      <ion-button fill="clear" class="sheet-close" (click)="closeAdjustments()">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </div>

  <div class="sheet-body">
    @if (formatOptions?.length && showFormatSelector) {
    <div class="format-row">
      <ion-segment
        class="format-segment"
        [value]="selectedFormatId ?? ''"
        (ionChange)="onFormatChange($event)"
        scrollable="true"
      >
        @for (opt of (formatOptions ?? []); track opt.id) {
        <ion-segment-button [value]="opt.id">
          {{ opt.label }}
        </ion-segment-button>
        }
      </ion-segment>
    </div>
    }

    @if (showRotate) {
    <ion-item lines="none" class="rot-item">
      <ion-label>{{ uiLabels.rotateLabel }}</ion-label>

        <ion-buttons slot="end" class="rot-actions">
          <ion-button fill="clear" class="rot-btn" (click)="rotateLeft()">
            <ion-icon slot="icon-only" name="return-up-back-outline"></ion-icon>
          </ion-button>

          <ion-button fill="clear" class="rot-btn" (click)="rotateRight()">
            <ion-icon slot="icon-only" name="return-up-forward-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>
    }

      <ion-item lines="none">
        <ion-label>{{ uiLabels.brightnessLabel }}</ion-label>
        <ion-range
          [min]="0.5"
          [max]="1.5"
          [step]="0.01"
          [(ngModel)]="brightness"
          (ionInput)="onAdjustChanged()"
        ></ion-range>
      </ion-item>

      <ion-item lines="none">
        <ion-label>{{ uiLabels.saturationLabel }}</ion-label>
        <ion-range
          [min]="0"
          [max]="2"
          [step]="0.01"
          [(ngModel)]="saturation"
          (ionInput)="onAdjustChanged()"
          [disabled]="bw"
        ></ion-range>
      </ion-item>

      <ion-item lines="none">
        <ion-label>{{ uiLabels.contrastLabel }}</ion-label>
        <ion-range
          [min]="0.5"
          [max]="1.8"
          [step]="0.01"
          [(ngModel)]="contrast"
          (ionInput)="onAdjustChanged()"
        ></ion-range>
      </ion-item>

      <ion-item lines="none" class="toggles">
        <ion-label>{{ uiLabels.bwLabel }}</ion-label>
        <ion-toggle
          [(ngModel)]="bw"
          (ionChange)="onAdjustChanged()"
        ></ion-toggle>

        <div class="row-spacer"></div>

        <ion-label class="dither-label" [class.disabled]="!bw">
          {{ uiLabels.ditherLabel }}
        </ion-label>
        <ion-toggle
          [(ngModel)]="dither"
          (ionChange)="onAdjustChanged()"
          [disabled]="!bw"
        ></ion-toggle>
      </ion-item>
    </div>
  </div>
  }
</ion-content>
