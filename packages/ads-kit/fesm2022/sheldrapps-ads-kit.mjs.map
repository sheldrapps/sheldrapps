{"version":3,"file":"sheldrapps-ads-kit.mjs","sources":["../../src/lib/types.ts","../../src/lib/consent.service.ts","../../src/lib/adapters/platform.ts","../../src/lib/ads.service.ts","../../src/lib/ads.providers.ts","../../src/public-api.ts","../../src/sheldrapps-ads-kit.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\r\n\r\n/**\r\n * Ad unit IDs for different ad formats\r\n */\r\nexport type AdsUnits = {\r\n  rewarded: string;\r\n  // Future: banner, interstitial, etc.\r\n};\r\n\r\n/**\r\n * Platform-specific ad units\r\n */\r\nexport type PlatformUnits = {\r\n  test: AdsUnits;\r\n  prod: AdsUnits;\r\n};\r\n\r\n/**\r\n * Configuration for ads-kit\r\n */\r\nexport interface AdsKitConfig {\r\n  /**\r\n   * Whether to use test ads (equivalent to !environment.production)\r\n   */\r\n  isTesting: boolean;\r\n\r\n  /**\r\n   * Ad units by platform\r\n   */\r\n  units: {\r\n    android: PlatformUnits;\r\n    ios?: PlatformUnits;\r\n  };\r\n\r\n  /**\r\n   * Optional debug logging\r\n   */\r\n  debug?: boolean;\r\n}\r\n\r\n/**\r\n * Injection token for AdsKitConfig\r\n */\r\nexport const ADS_KIT_CONFIG = new InjectionToken<AdsKitConfig>('ADS_KIT_CONFIG');\r\n\r\n/**\r\n * Consent status from UMP\r\n */\r\nexport type ConsentResult = {\r\n  canRequestAds: boolean;\r\n  privacyOptionsRequired: boolean;\r\n  umpReady: boolean;\r\n};\r\n","import { Injectable } from '@angular/core';\r\nimport { AdMob } from '@capacitor-community/admob';\r\nimport type { ConsentResult } from './types';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class ConsentService {\r\n  private canRequestAds = false;\r\n  private privacyOptionsRequired = false;\r\n  private umpReady = false;\r\n\r\n  private readyResolve!: () => void;\r\n  readonly ready = new Promise<void>(\r\n    (resolve) => (this.readyResolve = resolve)\r\n  );\r\n\r\n  get state(): ConsentResult {\r\n    return {\r\n      canRequestAds: this.canRequestAds,\r\n      privacyOptionsRequired: this.privacyOptionsRequired,\r\n      umpReady: this.umpReady,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Call once on app launch (or before initializing ads).\r\n   */\r\n  async gatherConsent(): Promise<ConsentResult> {\r\n    try {\r\n      const info = await AdMob.requestConsentInfo({});\r\n\r\n      this.umpReady = true;\r\n      this.canRequestAds = info.status !== 'REQUIRED';\r\n      this.privacyOptionsRequired =\r\n        info.privacyOptionsRequirementStatus === 'REQUIRED';\r\n\r\n      if (info.isConsentFormAvailable && info.status === 'REQUIRED') {\r\n        const after = await AdMob.showConsentForm();\r\n        this.canRequestAds = after.status !== 'REQUIRED';\r\n        this.privacyOptionsRequired =\r\n          after.privacyOptionsRequirementStatus === 'REQUIRED';\r\n      }\r\n\r\n      return this.state;\r\n    } catch (e) {\r\n      console.error('[Consent] gatherConsent failed', e);\r\n\r\n      // Mark UMP as \"done\" (attempted), but ads are not allowed\r\n      this.umpReady = true;\r\n      this.canRequestAds = false;\r\n      this.privacyOptionsRequired = false;\r\n\r\n      return this.state;\r\n    } finally {\r\n      // Always unblock waiters\r\n      this.readyResolve?.();\r\n    }\r\n  }\r\n\r\n  async showPrivacyOptionsIfAvailable(): Promise<boolean> {\r\n    try {\r\n      if (!this.umpReady) return false;\r\n      await AdMob.showPrivacyOptionsForm();\r\n      return true;\r\n    } catch (e) {\r\n      console.error('[Consent] showPrivacyOptionsForm failed', e);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n","import { Capacitor } from '@capacitor/core';\r\n\r\n/**\r\n * Get current Capacitor platform\r\n */\r\nexport function getPlatform(): string {\r\n  return Capacitor.getPlatform();\r\n}\r\n\r\n/**\r\n * Check if running on native platform (Android or iOS)\r\n */\r\nexport function isNative(): boolean {\r\n  const platform = getPlatform();\r\n  return platform === 'android' || platform === 'ios';\r\n}\r\n\r\n/**\r\n * Check if running on Android\r\n */\r\nexport function isAndroid(): boolean {\r\n  return getPlatform() === 'android';\r\n}\r\n\r\n/**\r\n * Check if running on iOS\r\n */\r\nexport function isIOS(): boolean {\r\n  return getPlatform() === 'ios';\r\n}\r\n\r\n/**\r\n * Check if running on web\r\n */\r\nexport function isWeb(): boolean {\r\n  return getPlatform() === 'web';\r\n}\r\n","import { Injectable, inject } from '@angular/core';\r\nimport { AdMob, RewardAdOptions } from '@capacitor-community/admob';\r\nimport { ConsentService } from './consent.service';\r\nimport { ADS_KIT_CONFIG, type AdsUnits } from './types';\r\nimport { isNative, isAndroid, getPlatform } from './adapters/platform';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AdsService {\r\n  private initialized = false;\r\n  private readonly config = inject(ADS_KIT_CONFIG);\r\n  private readonly consent = inject(ConsentService);\r\n\r\n  private get platform() {\r\n    return getPlatform();\r\n  }\r\n\r\n  private get isNative(): boolean {\r\n    return isNative();\r\n  }\r\n\r\n  private get isAndroid(): boolean {\r\n    return isAndroid();\r\n  }\r\n\r\n  private get isTesting(): boolean {\r\n    return this.config.isTesting;\r\n  }\r\n\r\n  private get units(): AdsUnits {\r\n    if (this.isAndroid) {\r\n      const androidUnits = this.config.units.android;\r\n      return this.isTesting ? androidUnits.test : androidUnits.prod;\r\n    }\r\n    // Fallback to iOS or Android if iOS not configured\r\n    const iosUnits = this.config.units.ios || this.config.units.android;\r\n    return this.isTesting ? iosUnits.test : iosUnits.prod;\r\n  }\r\n\r\n  private canShowAds(): boolean {\r\n    const c = this.consent.state;\r\n    return c.umpReady && c.canRequestAds;\r\n  }\r\n\r\n  async init(): Promise<void> {\r\n    if (this.initialized) return;\r\n    if (!this.isNative) return;\r\n\r\n    if (this.config.debug) {\r\n      console.log('[Ads] Initializing AdMob', {\r\n        platform: this.platform,\r\n        isTesting: this.isTesting,\r\n      });\r\n    }\r\n\r\n    await AdMob.initialize();\r\n    this.initialized = true;\r\n  }\r\n\r\n  async showRewarded(): Promise<boolean> {\r\n    await this.init();\r\n    if (!this.initialized) return false;\r\n\r\n    await this.consent.ready.catch(() => undefined);\r\n    if (!this.canShowAds()) return false;\r\n\r\n    const opts: RewardAdOptions = {\r\n      adId: this.units.rewarded,\r\n      isTesting: this.isTesting,\r\n    };\r\n\r\n    try {\r\n      if (this.config.debug) {\r\n        console.log('[Ads] Preparing rewarded ad', opts);\r\n      }\r\n      await AdMob.prepareRewardVideoAd(opts);\r\n      await AdMob.showRewardVideoAd();\r\n      return true;\r\n    } catch (e) {\r\n      console.warn('[Ads] rewarded failed', e);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n","import { Provider } from '@angular/core';\r\nimport { ADS_KIT_CONFIG, type AdsKitConfig } from './types';\r\nimport { AdsService } from './ads.service';\r\nimport { ConsentService } from './consent.service';\r\n\r\n/**\r\n * Main provider factory for ads-kit\r\n * Set up all necessary providers for AdMob and UMP consent\r\n *\r\n * @param config Ads configuration\r\n * @returns Array of Angular providers\r\n *\r\n * @example\r\n * bootstrapApplication(AppComponent, {\r\n *   providers: [\r\n *     provideAdsKit({\r\n *       isTesting: !environment.production,\r\n *       units: {\r\n *         android: {\r\n *           test: { rewarded: 'ca-app-pub-3940256099942544/5224354917' },\r\n *           prod: { rewarded: 'ca-app-pub-1676607690625695/8384333921' }\r\n *         }\r\n *       }\r\n *     })\r\n *   ]\r\n * });\r\n */\r\nexport function provideAdsKit(config: AdsKitConfig): Provider[] {\r\n  return [\r\n    // Provide config via injection token\r\n    { provide: ADS_KIT_CONFIG, useValue: config },\r\n\r\n    // Provide services\r\n    AdsService,\r\n    ConsentService,\r\n  ];\r\n}\r\n","/**\r\n * Public API for @sheldrapps/ads-kit\r\n */\r\n\r\n// Core exports\r\nexport * from './lib/types';\r\nexport * from './lib/ads.service';\r\nexport * from './lib/consent.service';\r\nexport * from './lib/ads.providers';\r\n\r\n// Adapter exports\r\nexport * from './lib/adapters/platform';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}