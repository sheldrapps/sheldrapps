{"version":3,"file":"sheldrapps-i18n-kit.mjs","sources":["../../src/lib/types.ts","../../src/lib/language-normalizer.ts","../../src/lib/storage.ts","../../src/lib/adapters/device-lang.ts","../../src/lib/language.service.ts","../../src/lib/case-preserving-loader.ts","../../src/lib/translate.providers.ts","../../src/public-api.ts","../../src/sheldrapps-i18n-kit.ts"],"sourcesContent":["/**\r\n * Core types for i18n-kit package\r\n */\r\n\r\nimport { InjectionToken } from '@angular/core';\r\nimport { StorageAdapter } from './storage';\r\n\r\nexport interface LanguageLoaderConfig {\r\n  /**\r\n   * Prefix for translation files (e.g., './assets/i18n/')\r\n   */\r\n  prefix: string;\r\n\r\n  /**\r\n   * Suffix for translation files (e.g., '.json')\r\n   */\r\n  suffix: string;\r\n}\r\n\r\nexport interface LanguageConfig {\r\n  /**\r\n   * Default language code (e.g., 'es-MX')\r\n   * Used as fallback if no saved language or system language detected\r\n   */\r\n  defaultLang: string;\r\n\r\n  /**\r\n   * Fallback language for TranslateService\r\n   * Used when a translation key is missing\r\n   */\r\n  fallbackLang: string;\r\n\r\n  /**\r\n   * Array of supported language codes (e.g., ['es-MX', 'en-US', 'de-DE'])\r\n   */\r\n  supportedLangs: string[];\r\n\r\n  /**\r\n   * localStorage key for persisting language choice\r\n   * @default 'lang'\r\n   */\r\n  storageKey?: string;\r\n\r\n  /**\r\n   * Loader configuration for TranslateHttpLoader\r\n   */\r\n  loader: LanguageLoaderConfig;\r\n\r\n  /**\r\n   * Map short language codes to full codes\r\n   * Example: { es: 'es-MX', en: 'en-US' }\r\n   */\r\n  normalizationMap?: Record<string, string>;\r\n\r\n  /**\r\n   * Whether to prefer saved language over system language\r\n   * @default true\r\n   */\r\n  preferSaved?: boolean;\r\n}\r\n\r\n/**\r\n * Injection token key for LanguageConfig\r\n */\r\nexport const LANGUAGE_CONFIG_TOKEN = new InjectionToken<LanguageConfig>(\r\n  'i18n-kit-config'\r\n);\r\n\r\n/**\r\n * InjectionToken for StorageAdapter\r\n */\r\nexport const STORAGE_ADAPTER_TOKEN = new InjectionToken<StorageAdapter>(\r\n  'i18n-kit-storage-adapter'\r\n);\r\n","/**\r\n * Language code normalization\r\n * Maps short codes (es, en) to full codes (es-MX, en-US)\r\n */\r\n\r\n/**\r\n * Canonicalize language code to standard format\r\n * Preserves correct case for locale codes to match JSON filenames\r\n * Examples: 'EN-us' -> 'en-US', 'fr-fr' -> 'fr-FR', 'es' -> 'es'\r\n */\r\nexport function canonicalizeLanguage(code: string): string {\r\n  if (!code) return '';\r\n\r\n  // Trim and replace underscores with hyphens\r\n  const cleaned = code.trim().replace(/_/g, '-');\r\n\r\n  // Split into parts\r\n  const parts = cleaned.split('-');\r\n  if (parts.length === 0) return '';\r\n\r\n  // Base language (first part) in lowercase\r\n  const base = parts[0].toLowerCase();\r\n\r\n  // Region (second part) in UPPERCASE if present\r\n  if (parts.length >= 2 && parts[1]) {\r\n    const region = parts[1].toUpperCase();\r\n    return `${base}-${region}`;\r\n  }\r\n\r\n  // No region, just return base\r\n  return base;\r\n}\r\n\r\n/**\r\n * Normalize language code to a supported variant\r\n * Handles:\r\n * - Short codes: es → map[es] → es-MX\r\n * - Full codes: es-MX → es-MX (pass through if valid)\r\n * - Case insensitive: ES-mx → es-MX (canonicalized)\r\n */\r\nexport function normalizeLanguage(\r\n  code: string,\r\n  supportedLangs: string[],\r\n  normalizationMap?: Record<string, string>\r\n): string | null {\r\n  if (!code) return null;\r\n\r\n  // First canonicalize to get proper case\r\n  const canonical = canonicalizeLanguage(code);\r\n  if (!canonical) return null;\r\n\r\n  // Try case-insensitive match in supported langs (returns canonical from list)\r\n  const supported = supportedLangs.find(\r\n    (lang) => lang.toLowerCase() === canonical.toLowerCase()\r\n  );\r\n  if (supported) return supported;\r\n\r\n  // Extract base and try mapping\r\n  const base = canonical.split('-')[0].toLowerCase();\r\n  const mapped = normalizationMap?.[base];\r\n\r\n  if (mapped && isLanguageSupported(mapped, supportedLangs)) {\r\n    return mapped;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Check if a language code is in the supported list\r\n */\r\nexport function isLanguageSupported(\r\n  code: string,\r\n  supportedLangs: string[]\r\n): boolean {\r\n  if (!code) return false;\r\n  const normalized = code.trim().toLowerCase();\r\n  return supportedLangs.some((lang) => lang.toLowerCase() === normalized);\r\n}\r\n\r\n/**\r\n * Build default normalization map from supported languages\r\n * Auto-extracts base codes: ['es-MX', 'en-US'] → { es: 'es-MX', en: 'en-US' }\r\n * Preserves canonical case from supportedLangs\r\n */\r\nexport function buildDefaultNormalizationMap(\r\n  supportedLangs: string[]\r\n): Record<string, string> {\r\n  const map: Record<string, string> = {};\r\n\r\n  for (const lang of supportedLangs) {\r\n    const base = lang.split(/[-_]/)[0].toLowerCase();\r\n    // Only add if base is not already mapped (first occurrence wins)\r\n    if (!map[base]) {\r\n      map[base] = lang; // Keep canonical case from supportedLangs\r\n    }\r\n  }\r\n\r\n  return map;\r\n}\r\n","/**\r\n * localStorage wrapper for language persistence\r\n */\r\n\r\nexport interface StorageAdapter {\r\n  getItem(key: string): string | null;\r\n  setItem(key: string, value: string): void;\r\n  removeItem(key: string): void;\r\n}\r\n\r\n/**\r\n * Default localStorage adapter\r\n */\r\nexport class LocalStorageAdapter implements StorageAdapter {\r\n  getItem(key: string): string | null {\r\n    try {\r\n      return typeof localStorage !== 'undefined' ? localStorage.getItem(key) : null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  setItem(key: string, value: string): void {\r\n    try {\r\n      if (typeof localStorage !== 'undefined') {\r\n        localStorage.setItem(key, value);\r\n      }\r\n    } catch {\r\n      // Silent fail for SSR or blocked storage\r\n    }\r\n  }\r\n\r\n  removeItem(key: string): void {\r\n    try {\r\n      if (typeof localStorage !== 'undefined') {\r\n        localStorage.removeItem(key);\r\n      }\r\n    } catch {\r\n      // Silent fail\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * In-memory adapter (useful for SSR or testing)\r\n */\r\nexport class MemoryStorageAdapter implements StorageAdapter {\r\n  private data: Record<string, string> = {};\r\n\r\n  getItem(key: string): string | null {\r\n    return this.data[key] ?? null;\r\n  }\r\n\r\n  setItem(key: string, value: string): void {\r\n    this.data[key] = value;\r\n  }\r\n\r\n  removeItem(key: string): void {\r\n    delete this.data[key];\r\n  }\r\n}\r\n","/**\r\n * Device language detection adapter\r\n * Tries Capacitor Device API first, falls back to navigator.language\r\n */\r\n\r\n/**\r\n * Get language code from device\r\n * Attempts Capacitor Device.getLanguageCode() first, then navigator.language\r\n * Returns raw code without case transformation (will be canonicalized by normalizer)\r\n */\r\nexport async function getDeviceLanguage(): Promise<string> {\r\n  try {\r\n    // Try Capacitor Device API\r\n    const { Device } = await import('@capacitor/device');\r\n    const info = await Device.getLanguageCode();\r\n    const code = info?.value || '';\r\n    if (code) return code; // No toLowerCase - preserve raw format\r\n  } catch {\r\n    // Capacitor not available or failed\r\n  }\r\n\r\n  // Fallback to browser navigator\r\n  try {\r\n    return navigator.language || ''; // No toLowerCase - preserve raw format\r\n  } catch {\r\n    return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Extract language base code (es from es-MX, en from en-US, etc.)\r\n * Returns base in lowercase for comparison purposes\r\n */\r\nexport function extractLanguageBase(code: string): string {\r\n  if (!code) return '';\r\n  const base = code.trim().split(/[-_]/)[0].toLowerCase();\r\n  return base;\r\n}\r\n","/**\r\n * Core LanguageService for i18n-kit\r\n * Manages language selection, persistence, and detection\r\n */\r\n\r\nimport { Injectable, Inject, Optional } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { lastValueFrom } from 'rxjs';\r\n\r\nimport {\r\n  LanguageConfig,\r\n  LANGUAGE_CONFIG_TOKEN,\r\n  STORAGE_ADAPTER_TOKEN,\r\n} from './types';\r\nimport {\r\n  normalizeLanguage,\r\n  isLanguageSupported,\r\n  buildDefaultNormalizationMap,\r\n} from './language-normalizer';\r\nimport { StorageAdapter, LocalStorageAdapter } from './storage';\r\nimport { getDeviceLanguage } from './adapters/device-lang';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class LanguageService {\r\n  private currentLang: string;\r\n  private config!: LanguageConfig;\r\n  private storage: StorageAdapter;\r\n  private normMap: Record<string, string>;\r\n\r\n  constructor(\r\n    private translateService: TranslateService,\r\n    @Optional()\r\n    @Inject(LANGUAGE_CONFIG_TOKEN)\r\n    config?: LanguageConfig,\r\n    @Optional()\r\n    @Inject(STORAGE_ADAPTER_TOKEN)\r\n    storage?: StorageAdapter\r\n  ) {\r\n    this.currentLang = config?.defaultLang ?? 'en-US';\r\n    this.config = config || this.getDefaultConfig();\r\n    this.storage = storage || new LocalStorageAdapter();\r\n    this.normMap = config?.normalizationMap\r\n      ? { ...config.normalizationMap }\r\n      : buildDefaultNormalizationMap(config?.supportedLangs ?? []);\r\n  }\r\n\r\n  /**\r\n   * Get current language\r\n   */\r\n  get lang(): string {\r\n    return this.currentLang;\r\n  }\r\n\r\n  /**\r\n   * Get supported languages from config\r\n   */\r\n  get supported(): string[] {\r\n    return [...this.config.supportedLangs];\r\n  }\r\n\r\n  /**\r\n   * Initialize language service\r\n   * Priority: saved > system > default\r\n   */\r\n  async init(): Promise<string> {\r\n    console.log('[i18n-kit] LanguageService.init() START');\r\n    console.log('[i18n-kit] Config:', {\r\n      defaultLang: this.config.defaultLang,\r\n      supportedLangs: this.config.supportedLangs,\r\n      storageKey: this.config.storageKey || 'lang',\r\n    });\r\n\r\n    this.translateService.setDefaultLang(this.config.defaultLang);\r\n    console.log('[i18n-kit] translate.setDefaultLang() called');\r\n\r\n    const saved = this.getSaved();\r\n    console.log('[i18n-kit] saved from storage:', saved);\r\n\r\n    const system = await this.getSystemLang();\r\n    console.log('[i18n-kit] system language detected:', system);\r\n\r\n    const preferSaved = this.config.preferSaved !== false; // Default true\r\n\r\n    const final =\r\n      (preferSaved && saved) || system || this.config.defaultLang;\r\n\r\n    console.log('[i18n-kit] final language chosen:', final);\r\n    await this.set(final);\r\n    console.log('[i18n-kit] LanguageService.init() COMPLETE, currentLang:', this.currentLang);\r\n    return this.currentLang;\r\n  }\r\n\r\n  /**\r\n   * Set language\r\n   * Normalizes, validates, and persists the language\r\n   */\r\n  async set(lang: string): Promise<void> {\r\n    console.log('[i18n-kit] LanguageService.set() called with:', lang);\r\n\r\n    const normalized = this.normalize(lang);\r\n    console.log('[i18n-kit] normalized language:', normalized);\r\n\r\n    // If normalization fails, fallback to default\r\n    const valid =\r\n      normalized && isLanguageSupported(normalized, this.config.supportedLangs)\r\n        ? normalized\r\n        : this.config.defaultLang;\r\n\r\n    console.log('[i18n-kit] valid language (after fallback):', valid);\r\n\r\n    this.currentLang = valid;\r\n    const key = this.config.storageKey || 'lang';\r\n    this.storage.setItem(key, valid);\r\n    console.log('[i18n-kit] localStorage.setItem(\"' + key + '\", \"' + valid + '\")');\r\n\r\n    console.log('[i18n-kit] calling translate.use(\"' + valid + '\")');\r\n    await lastValueFrom(this.translateService.use(valid));\r\n    console.log('[i18n-kit] translate.currentLang after use():', this.translateService.currentLang);\r\n  }\r\n\r\n  /**\r\n   * Get saved language from storage\r\n   */\r\n  getSaved(): string | null {\r\n    const key = this.config.storageKey || 'lang';\r\n    const saved = this.storage.getItem(key);\r\n    console.log('[i18n-kit] LanguageService.getSaved() from localStorage(\"' + key + '\"):', saved);\r\n\r\n    if (!saved) {\r\n      console.log('[i18n-kit] No saved language in localStorage, returning null');\r\n      return null;\r\n    }\r\n\r\n    const normalized = this.normalize(saved);\r\n    console.log('[i18n-kit] Normalized saved language:', normalized);\r\n\r\n    if (\r\n      normalized &&\r\n      isLanguageSupported(normalized, this.config.supportedLangs)\r\n    ) {\r\n      console.log('[i18n-kit] Returning normalized saved language:', normalized);\r\n      return normalized;\r\n    }\r\n\r\n    console.log('[i18n-kit] Saved language not supported, returning null');\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Detect system language\r\n   */\r\n  async getSystemLang(): Promise<string | null> {\r\n    console.log('[i18n-kit] LanguageService.getSystemLang() called');\r\n    const deviceLang = await getDeviceLanguage();\r\n    console.log('[i18n-kit] Device language detected:', deviceLang);\r\n    const normalized = this.normalize(deviceLang);\r\n    console.log('[i18n-kit] Device language normalized:', normalized);\r\n    return normalized;\r\n  }\r\n\r\n  /**\r\n   * Normalize language code\r\n   * Maps short codes to full codes and validates\r\n   */\r\n  private normalize(code: string): string | null {\r\n    return normalizeLanguage(code, this.config.supportedLangs, this.normMap);\r\n  }\r\n\r\n  /**\r\n   * Get default config (fallback if not provided)\r\n   */\r\n  private getDefaultConfig(): LanguageConfig {\r\n    return {\r\n      defaultLang: 'en-US',\r\n      fallbackLang: 'en-US',\r\n      supportedLangs: ['en-US'],\r\n      loader: { prefix: './assets/i18n/', suffix: '.json' },\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { TranslateLoader } from '@ngx-translate/core';\r\nimport { Observable } from 'rxjs';\r\n\r\n/**\r\n * Case-preserving TranslateLoader\r\n * Ensures the lang code is used exactly as provided (no lowercasing)\r\n */\r\nexport class CasePreservingTranslateLoader implements TranslateLoader {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private prefix: string,\r\n    private suffix: string\r\n  ) {}\r\n\r\n  getTranslation(lang: string): Observable<any> {\r\n    const url = `${this.prefix}${lang}${this.suffix}`;\r\n    console.log('[i18n-kit] loader.getTranslation lang:', lang);\r\n    console.log('[i18n-kit] loader.getTranslation url:', url);\r\n    return this.http.get<any>(url);\r\n  }\r\n}\r\n\r\nexport function createCasePreservingTranslateLoader(\r\n  http: HttpClient,\r\n  prefix: string,\r\n  suffix: string\r\n): TranslateLoader {\r\n  return new CasePreservingTranslateLoader(http, prefix, suffix);\r\n}","/**\r\n * Angular providers factory for i18n-kit\r\n * Configures TranslateService and LanguageService\r\n */\r\n\r\nimport { Provider, EnvironmentProviders } from '@angular/core';\r\nimport { HttpClient, provideHttpClient } from '@angular/common/http';\r\nimport { provideTranslateService, TranslateLoader } from '@ngx-translate/core';\r\n\r\nimport {\r\n  LanguageConfig,\r\n  LANGUAGE_CONFIG_TOKEN,\r\n  STORAGE_ADAPTER_TOKEN,\r\n} from './types';\r\nimport { LanguageService } from './language.service';\r\nimport { StorageAdapter, LocalStorageAdapter } from './storage';\r\nimport { createCasePreservingTranslateLoader } from './case-preserving-loader';\r\n\r\n/**\r\n * Main provider factory for i18n-kit\r\n * Set up all necessary providers for translation and language management\r\n *\r\n * @param config Language configuration\r\n * @param storageAdapter Optional custom storage adapter\r\n * @returns Array of Angular providers\r\n *\r\n * @example\r\n * bootstrapApplication(AppComponent, {\r\n *   providers: [\r\n *     provideI18nKit({\r\n *       defaultLang: 'es-MX',\r\n *       fallbackLang: 'en-US',\r\n *       supportedLangs: ['es-MX', 'en-US', 'de-DE'],\r\n *       loader: { prefix: './assets/i18n/', suffix: '.json' },\r\n *       normalizationMap: { es: 'es-MX', en: 'en-US' }\r\n *     })\r\n *   ]\r\n * });\r\n */\r\nexport function provideI18nKit(\r\n  config: LanguageConfig,\r\n  storageAdapter?: StorageAdapter\r\n): (Provider | EnvironmentProviders)[] {\r\n  console.log('[i18n-kit] USING i18n-kit v1.0.0');\r\n  return [\r\n    // Provide config via injection token\r\n    { provide: LANGUAGE_CONFIG_TOKEN, useValue: config },\r\n\r\n    // Provide custom storage or default\r\n    {\r\n      provide: STORAGE_ADAPTER_TOKEN,\r\n      useValue: storageAdapter || new LocalStorageAdapter(),\r\n    },\r\n\r\n    // Provide HTTP client (required for HttpLoader)\r\n    provideHttpClient(),\r\n\r\n    // Configure TranslateService with loader\r\n    provideTranslateService({\r\n      defaultLanguage: config.defaultLang,\r\n    }),\r\n\r\n    // Configure case-preserving TranslateLoader\r\n    {\r\n      provide: TranslateLoader,\r\n      useFactory: (http: HttpClient) =>\r\n        createCasePreservingTranslateLoader(\r\n          http,\r\n          config.loader.prefix,\r\n          config.loader.suffix\r\n        ),\r\n      deps: [HttpClient],\r\n    },\r\n\r\n    // Provide LanguageService\r\n    LanguageService,\r\n  ];\r\n}\r\n","/**\r\n * Public API for @sheldrapps/i18n-kit\r\n */\r\n\r\n// Core exports\r\nexport * from './lib/types';\r\nexport * from './lib/language.service';\r\nexport * from './lib/language-normalizer';\r\nexport * from './lib/translate.providers';\r\nexport * from './lib/case-preserving-loader';\r\nexport * from './lib/storage';\r\n\r\n// Adapter exports\r\nexport * from './lib/adapters/device-lang';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}